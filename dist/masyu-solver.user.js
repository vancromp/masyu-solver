// ==UserScript==
// @name        Krazydad Masyu Solver
// @version     1
// @grant       none
// @include     https://krazydad.com/tablet/masyu/*
// @run-at      document-idle
// ==/UserScript==
parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r},p.cache={};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({"4+sz":[function(require,module,exports) {
function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}var e=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),n=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function u(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,u)}l((r=r.apply(t,e||[])).next())})},r=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}},i=this,o="OMG, it's Typescript!";console.log(o);var s=!0,u=50,l=!1,c=2e3;if(!s)throw new Error("stop execution");var a=window.puzzWidth,h=window.puzzHeight,p=window.myVerts,f=window.myEdges,d=window.myCells;if(!(a&&h&&p&&f&&d))throw new Error("Solver: missing key variable ("+a+", "+h+", "+p+", "+f+", "+d+")");function g(t,e){return t<0||t>a||e<0||e>h?null:p[t+(a+1)*e]}function E(t,e,n,r){return f.find(function(i){return i.x1===t&&i.x2===n&&i.y1===e&&i.y2===r||i.x1===n&&i.x2===t&&i.y1===r&&i.y2===e})}function v(t,e){return t<0||t>=a||e<0||e>=h?null:d[t+a*e]}var y=[];function b(t){y.push(t)}function O(t,e){return new Promise(function(n){return setTimeout(n,t,e)})}function m(){return n(this,void 0,void 0,function(){var t,e;return r(this,function(n){switch(n.label){case 0:console.log("Playing animation"),t=0,e=y,n.label=1;case 1:return t<e.length?((0,e[t])(),u?(window.refreshCanvas(),[4,O(u)]):[3,3]):[3,4];case 2:n.sent(),n.label=3;case 3:return t++,[3,1];case 4:return window.refreshCanvas(),[2]}})})}console.log("Initializing solver for "+a+"Ã—"+h);var w=function(){function t(t){this.name=t}return t.register=function(e){for(var n in e)t[n]=new t(n)},t.prototype.isViolated=function(){return this===t.VIOLATED},t.prototype.isResolved=function(){return this===t.RESOLVED},t}();w.register({UNCHANGED:0,CHANGED:1,RESOLVED:2,VIOLATED:3});var V=function(){function t(){}return t.prototype.tryResolve=function(){throw"Not Implemented"},t.prototype.getHypotheses=function(){return[]},t.prototype.backup=function(){},t.prototype.restore=function(){},t}(),S=function(t){function n(e,n){var r=t.call(this)||this;return r.x=e,r.y=n,r.leftEdge=r.rightEdge=r.topEdge=r.bottomEdge=null,r}return e(n,t),n.prototype.tryResolve=function(){var t=this.unknownEdges;if(0===t.length){var e=this.edges.filter(function(t){return t.isFilled()}).length;return[0,2].includes(e)?w.RESOLVED:w.VIOLATED}if(1===t.length){var n=this.knownEdges.filter(function(t){return t.state===x.FILLED}).length;return 3===n?w.VIOLATED:t[0].setFilled(1===n)}return 2===t.length&&this.knownEdges.every(function(t){return t.state===x.FILLED})?(t.forEach(function(t){t.state=x.EMPTY}),w.RESOLVED):w.UNCHANGED},Object.defineProperty(n.prototype,"edges",{get:function(){return[this.leftEdge,this.rightEdge,this.topEdge,this.bottomEdge]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"verticalEdges",{get:function(){return[this.topEdge,this.bottomEdge]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"horizontalEdges",{get:function(){return[this.leftEdge,this.rightEdge]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"unknownEdges",{get:function(){return this.edges.filter(function(t){return!t.isSolved()})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"knownEdges",{get:function(){return this.edges.filter(function(t){return t.isSolved()})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cells",{get:function(){return this.topEdge.cells.concat(this.bottomEdge.cells)},enumerable:!0,configurable:!0}),n.prototype.hasSameLineAs=function(t){return this.line&&this.line===t.line},n.prototype.getOpposedEdge=function(t){switch(t){case this.leftEdge:return this.rightEdge;case this.rightEdge:return this.leftEdge;case this.topEdge:return this.bottomEdge;case this.bottomEdge:return this.topEdge;default:throw"Not my edge: "+t}},n.prototype.getPerpendicularEdges=function(t){switch(t){case this.leftEdge:case this.rightEdge:return[this.topEdge,this.bottomEdge];case this.topEdge:case this.bottomEdge:return[this.leftEdge,this.rightEdge];default:throw"Not my edge: "+t}},n.prototype.getOpposedCell=function(t){switch(t){case this.leftEdge.top:return this.rightEdge.bottom;case this.rightEdge.top:return this.leftEdge.bottom;case this.leftEdge.bottom:return this.rightEdge.top;case this.rightEdge.bottom:return this.leftEdge.top;default:throw"Not my cell: "+t}},n.prototype.isSpecial=function(){return!1},n.prototype.getHypotheses=function(){if(!this.line)return[];var t=this.unknownEdges;return 2===t.length?t.map(function(t){return[t]}):[]},n.prototype.backup=function(){this._lineBackup=this.line},n.prototype.restore=function(){this.line=this._lineBackup},n.prototype.toString=function(){return this.constructor.name[0]+"("+this.x+","+this.y+")"},n}(V),L=function(t){function n(e,n){return t.call(this,e,n)||this}return e(n,t),n.prototype.tryResolve=function(){var e=this,n=t.prototype.tryResolve.call(this);if(n===w.VIOLATED)return n;if(n===w.RESOLVED)return 1===this.horizontalEdges.filter(function(t){return t.isFilled()}).length?w.VIOLATED:this.tryEnsureCorner();if(this.unknownEdges.length<4){for(var r=this.knownEdges,i=0,o=r;i<o.length;i++){var s=o[i];if(this.getOpposedEdge(s).setFilled(s.isFilled())===w.VIOLATED)return w.VIOLATED}var u=!r.some(function(t){return t.isFilled()});return this.unknownEdges.map(function(t){return t.setFilled(u)}).some(function(t){return t===w.VIOLATED})?w.VIOLATED:this.tryEnsureCorner()}for(var l=0,c=[this.horizontalEdges,this.verticalEdges];l<c.length;l++){var a=c[l];if(a.every(function(t){return t.getOpposedEdge(e).isFilled()}))return this.markPairEmpty(a);var h=a.map(function(t){return t.getOpposedVertex(e)});if(h[0].hasSameLineAs(h[1])&&!h[0].line.missesOneSpecial())return this.markPairEmpty(a)}return this.cells.filter(function(t){return t.isSolved()}).forEach(function(t){e.getOpposedCell(t).state=t.state.inverse()}),!1},n.prototype.markPairEmpty=function(t){return t.map(function(t){return t.setEmpty()}).some(function(t){return t.isViolated()})||this.getPerpendicularEdges(t[0]).map(function(t){return t.setFilled()}).some(function(t){return t.isViolated()})?w.VIOLATED:this.tryEnsureCorner()},n.prototype.tryEnsureCorner=function(){var t=this,e=this.edges.filter(function(t){return t.state===x.FILLED});if(e.some(function(e){return e.getOpposedVertex(t).getPerpendicularEdges(e).some(function(t){return t.state===x.FILLED})}))return w.RESOLVED;var n=e.find(function(e){return e.getOpposedEdge(t).state===x.FILLED});if(n){var r=this.getOpposedEdge(n).getOpposedEdge(this);return r.isFilled()?w.VIOLATED:(r.state=x.EMPTY,w.RESOLVED)}},n.prototype.getHypotheses=function(){var t=this;if(4===this.knownEdges.length){var e=this.edges.filter(function(t){return t.isFilled()}).map(function(e){return e.getOpposedEdge(t)}).filter(function(t){return!t.isSolved()});return 2===e.length?e.map(function(t){return[function(){return t.setEmpty()}]}):[]}return[this.verticalEdges,this.horizontalEdges]},n.prototype.isSpecial=function(){return!0},n}(S),D=function(t){function n(e,n){return t.call(this,e,n)||this}return e(n,t),n.prototype.tryResolve=function(){var t=this;this.unknownEdges.forEach(function(e){e.getOpposedEdge(t).state===x.EMPTY&&(e.state=x.EMPTY),e.getOpposedVertex(t).getPerpendicularEdges(e).some(function(t){return t.state===x.FILLED})&&(e.state=x.EMPTY)});for(var e=0,n=this.knownEdges;e<n.length;e++){var r=n[e],i=this.getOpposedEdge(r);if(i.setFilled(!r.isFilled()).isViolated())return w.VIOLATED;if((r.isFilled()?r:i).getOpposedEdge(this).setFilled(!0).isViolated())return w.VIOLATED}return 0===this.unknownEdges.length?w.RESOLVED:w.UNCHANGED},n.prototype.getHypotheses=function(){var t=this;return this.topEdge.isSolved()?this.horizontalEdges.map(function(t){return[t]}):this.leftEdge.isSolved()?this.verticalEdges.map(function(t){return[t]}):this.verticalEdges.reduce(function(e,n){return e.concat(t.horizontalEdges.map(function(t){return[n,t]}))},[])},n.prototype.isSpecial=function(){return!0},n}(S),k=function(t){function n(e){var n=t.call(this)||this;return n.edge=e,n}return e(n,t),n.prototype.tryResolve=function(){var t=this.edge;if(t.isSolved())return w.RESOLVED;if(!this.edgesToWatch){var e=t.vertex1.getOpposedEdge(t),n=t.vertex2.getOpposedEdge(t);this.watchedVertex1=e.getOpposedVertex(t.vertex1),this.watchedVertex2=n.getOpposedVertex(t.vertex2),this.edgesToWatch=[this.watchedVertex1.getOpposedEdge(e),this.watchedVertex2.getOpposedEdge(n)]}return this.watchedVertex1.line&&this.watchedVertex1.line===this.watchedVertex2.line||this.edgesToWatch.some(function(t){return t.state===x.FILLED})?(t.state=x.EMPTY,w.RESOLVED):this.edgesToWatch.every(function(t){return t.state===x.EMPTY})?w.RESOLVED:w.UNCHANGED},n}(V),x={UNKNOWN:{value:0,inverse:function(){return x.UNKNOWN}},EMPTY:{value:1,inverse:function(){return x.FILLED}},FILLED:{value:2,inverse:function(){return x.EMPTY}}},P=0,N=function(t){function n(e){var n=t.call(this)||this;return n._state=x.UNKNOWN,n.puzzEdge=e,n}return e(n,t),n.prototype.isSolved=function(){return this.state!==x.UNKNOWN},n.prototype.isFilled=function(){return this.state===x.FILLED},n.prototype.setFilled=function(t){return"boolean"!=typeof t&&(t=!0),this.isSolved()?this.isFilled()!==t?w.VIOLATED:w.RESOLVED:this.cell1.isSolved()&&this.cell2.isSolved()&&this.cell1.state===this.cell2.state===t?w.VIOLATED:t&&this.vertex1.hasSameLineAs(this.vertex2)&&!this.vertex1.line.isAlmostSolution()?w.VIOLATED:(this.state=t?x.FILLED:x.EMPTY,w.RESOLVED)},n.prototype.isEmpty=function(){return this.state===x.EMPTY},n.prototype.setEmpty=function(){return this.setFilled(!1)},n.prototype.tryResolve=function(){return this.isSolved()?w.RESOLVED:this.cell1.isSolved()&&this.cell2.isSolved()?this.setFilled(this.cell1.state!==this.cell2.state):this.vertex1.line&&this.vertex1.line===this.vertex2.line&&!this.vertex1.line.containsAllSpecials()?(this.state=x.EMPTY,w.RESOLVED):w.UNCHANGED},Object.defineProperty(n.prototype,"state",{get:function(){return this._state},set:function(t){if(this.isSolved()&&t!==this._state)throw"IllegalState: "+this+" is already solved";switch(t){case x.EMPTY:case x.FILLED:break;default:throw"IllegalArgument: "+t}this._state!==t&&(P++,this._state=t,this.syncWithCanvas(),t===x.FILLED&&F.recordFilledEdge(this))},enumerable:!0,configurable:!0}),n.prototype.syncWithCanvas=function(){var t=this;if(this.puzzEdge){var e=this.state.value;b(function(){t.puzzEdge.s=e})}},Object.defineProperty(n.prototype,"vertices",{get:function(){return[this.vertex1,this.vertex2]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cells",{get:function(){return[this.cell1,this.cell2]},enumerable:!0,configurable:!0}),n.prototype.contains=function(t){return this.vertices.some(function(e){return e===t})},n.prototype.getOpposedVertex=function(t){return t===this.vertex1?this.vertex2:this.vertex1},n.prototype.getOpposedEdge=function(t){return this.getOpposedVertex(t).getOpposedEdge(this)},n.prototype.getOpposedCell=function(t){return t===this.cell1?this.cell2:this.cell1},n.prototype.backup=function(){this._stateBackup=this._state,this._lineBackup=this.line},n.prototype.restore=function(){this.line=this._lineBackup,this._state!==this._stateBackup&&(this._state=this._stateBackup,this.syncWithCanvas())},n.prototype.toString=function(){return"E["+this.vertex1+"->"+this.vertex2+"]"},n}(V),I=function(t){function n(e,n,r){var i=t.call(this,r)||this;return i.top=e,i.bottom=n,i.left=null,i.right=null,i}return e(n,t),Object.defineProperty(n.prototype,"cell1",{get:function(){return this.left},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cell2",{get:function(){return this.right},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vertex1",{get:function(){return this.top},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vertex2",{get:function(){return this.bottom},enumerable:!0,configurable:!0}),n}(N),T=function(t){function n(e,n,r){var i=t.call(this,r)||this;return i.left=e,i.right=n,i.top=null,i.bottom=null,i}return e(n,t),Object.defineProperty(n.prototype,"cell1",{get:function(){return this.top},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cell2",{get:function(){return this.bottom},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vertex1",{get:function(){return this.left},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vertex2",{get:function(){return this.right},enumerable:!0,configurable:!0}),n}(N),A={UNKNOWN:{value:0,color:"",inverse:function(){return i}},INNIE:{value:1,color:"#AFF",inverse:function(){return A.OUTIE}},OUTIE:{value:2,color:"#FFA",inverse:function(){return A.INNIE}}},_=function(t){function n(e,n,r,i,o){var s=t.call(this)||this;return s.top=e,s.left=n,s.right=r,s.bottom=i,s._state=A.UNKNOWN,s.puzzCell=o,s}return e(n,t),n.prototype.isSolved=function(){return this.solved},Object.defineProperty(n.prototype,"solved",{get:function(){return this._state!==A.UNKNOWN},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"innie",{get:function(){return this._state===A.INNIE},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"outie",{get:function(){return this._state===A.OUTIE},enumerable:!0,configurable:!0}),n.prototype.tryResolve=function(){var t=this;if(this.isSolved())return w.RESOLVED;var e=this.edges.find(function(e){return e.isSolved()&&e.getOpposedCell(t).isSolved()});if(e){var n=e.getOpposedCell(this);return this.state=e.isFilled()?n.state.inverse():n.state,w.RESOLVED}return w.UNCHANGED},Object.defineProperty(n.prototype,"edges",{get:function(){return[this.top,this.left,this.right,this.bottom]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"state",{get:function(){return this._state},set:function(t){var e=this;if(this._state!==t&&(this._state=t,this.puzzCell)){var n=t.color;b(function(){e.puzzCell.fill=n})}},enumerable:!0,configurable:!0}),n.prototype.backup=function(){this._stateBackup=this._state},n.prototype.restore=function(){this.state=this._stateBackup},n}(V),z=[],F=function(){function t(t){this.edges=[t],this.setLineOn(t),this.specialVertices=t.vertices.filter(function(t){return t.isSpecial()}).length,this.start=t.vertex1,this.end=t.vertex2}return t.prototype.addEdge=function(t){var e;this.edges.push(t),this.setLineOn(t),e=t.contains(this.start)?this.start=t.getOpposedVertex(this.start):this.end=t.getOpposedVertex(this.end),console.assert(this.start!==this.end||this.isSolution(),"Cannot close incomplete loop"),e.isSpecial()&&this.start!==this.end&&(this.specialVertices++,this.checkSpecialVertices())},t.prototype.setLineOn=function(t){var e=this;t.line=this,t.vertices.forEach(function(t){t.line=e})},t.prototype.mergeWith=function(t,e){var n,r=this;this.edges.push(e),this.setLineOn(e),(n=this.edges).push.apply(n,t.edges),this.specialVertices+=t.specialVertices,this.checkSpecialVertices(),t.edges.forEach(function(t){return r.setLineOn(t)});var i=e.contains(t.start)?t.end:t.start;e.contains(this.start)?this.start=i:this.end=i},t.prototype.containsAllSpecials=function(){return this.specialVertices===C},t.prototype.checkSpecialVertices=function(){if(this.specialVertices>C)throw"IllegalState, too many specials: "+this.specialVertices},t.prototype.isAlmostSolution=function(){return this.specialVertices===C},t.prototype.missesOneSpecial=function(){return this.specialVertices===C-1},t.prototype.isSolution=function(){return this.specialVertices===C&&this.start===this.end},t.prototype.backup=function(){this._edgesBackup=this.edges.slice(0),this._specialVerticesBackup=this.specialVertices,this._startBackup=this.start,this._endBackup=this.end},t.prototype.restore=function(){this.edges=this._edgesBackup,this.specialVertices=this._specialVerticesBackup,this.start=this._startBackup,this.end=this._endBackup},t.prototype.toString=function(){return"L["+this.start+"->"+this.end+"]"},t.recordFilledEdge=function(e){var n=e.vertices.map(function(t){return t.line}).filter(function(t){return t}),r=null;switch(n.length){case 0:r=new t(e),z.push(r);break;case 1:(r=n[0]).addEdge(e);break;case 2:r=n[0];var i=n[1];r===i?r.addEdge(e):(r.mergeWith(i,e),z=z.filter(function(t){return t!==i}))}},t.isPuzzleSolved=function(){return 1===z.length&&z[0].isSolution()},t.backup=function(){t._linesBackup=z.slice(0),z.forEach(function(t){return t.backup()})},t.restore=function(){(z=t._linesBackup).forEach(function(t){return t.restore()})},t}(),C=0,R=[],j=[];function H(t){t.vertex1 instanceof L&&t.vertex2 instanceof L&&(t.vertex1.getOpposedEdge(t).getOpposedVertex(t.vertex1)instanceof L?t.state=x.EMPTY:R.push(new k(t))),t.vertex1 instanceof D&&t.vertex2 instanceof D&&(t.state=x.EMPTY)}!function(){for(var t=-1;t<=a+1;t++){j[t]=[];for(var e=-1;e<=h+1;e++){var n=g(t,e),r=void 0;if(n&&"_"!==n.clue)switch(n.clue){case"O":r=new L(t,e),C++;break;case"@":r=new D(t,e),C++;break;default:throw"Unknown clue: "+t+","+e+": "+n.clue}else r=new S(t,e);j[t][e]=r,t>=0&&t<=a&&e>=0&&e<=h&&R.push(r)}}}();var U=[];!function(){for(var t=-1;t<=a;t++){U[t]=[];for(var e=0;e<=h;e++){var n=j[t][e],r=j[t+1][e],i=new T(n,r,E(t,e,t+1,e));U[t][e]=i,t<0||t===a?i.state=x.EMPTY:R.push(i),n.rightEdge=i,r.leftEdge=i,t>0&&t<a-1&&H(i)}}}();var B=[];!function(){for(var t=0;t<=a;t++){B[t]=[];for(var e=-1;e<=h;e++){var n=j[t][e],r=j[t][e+1],i=new I(n,r,E(t,e,t,e+1));B[t][e]=i,e<0||e===h?i.state=x.EMPTY:R.push(i),n.bottomEdge=i,r.topEdge=i,e>0&&e<h-1&&H(i)}}}();var M=[];function G(){for(var t=R.length,e=[],n=0,r=R;n<r.length;n++){var i=r[n];switch(i.tryResolve()){case w.VIOLATED:return w.VIOLATED;case w.RESOLVED:break;default:e.push(i)}}return t!==(R=e).length?w.CHANGED:w.UNCHANGED}function W(){var t=P,e=G();return e===w.VIOLATED?e:e===w.CHANGED||t!==P?w.CHANGED:w.UNCHANGED}function Y(){var t,e=0;do{if(e++,(t=W())===w.VIOLATED)return t}while(t===w.CHANGED);return e>1?w.CHANGED:w.UNCHANGED}function K(t){return t.forEach(function(t){return"function"==typeof t?t():t.setFilled()}),Y()}function q(){var e;do{window.refreshCanvas(),e=!1;for(var n=function(n){for(var r=n.getHypotheses(),i=[],o=function(t){console.log("Trying hypothesis "+t),b(function(){return console.log("Showing hypothesis "+t)});var e=P,n=R.slice(0);if(F.backup(),R.forEach(function(t){return t.backup()}),K(t)!==w.VIOLATED){if(F.isPuzzleSolved())return console.log("Puzzle appears to be solved"),{value:void 0};i.push(t),b(function(){return console.log("Reverting hypothesis "+t)})}else console.log("Hypothesis rejected"),b(function(){return console.log("Hypothesis "+t+" rejected")});n.forEach(function(t){return t.restore()}),F.restore(),R=n,P=e},s=0,u=r;s<u.length;s++){var l=o(u[s]);if("object"===t(l))return l}if(console.assert(0===r.length||i.length>0,"At least one hypothesis should be valid"),1===i.length){var c=i[0];return console.log("Keeping single valid hypothesis "+c),b(function(){return console.log("Restoring single valid hypothesis "+c)}),K(c),e=!0,"break"}},r=0,i=R;r<i.length;r++){var o=n(i[r]);if("object"===t(o))return o.value;if("break"===o)break}}while(e)}!function(){for(var t=-1;t<=a;t++){M[t]=[];for(var e=-1;e<=h;e++){var n=void 0,r=void 0,i=void 0,o=void 0;n=e>=0?n=U[t][e]:null,r=t>=0?B[t][e]:null,i=t<a?B[t+1][e]:null,o=e<h?U[t][e+1]:null;var s=new _(n,r,i,o,v(t,e));-1===t||t===a||-1===e||e===h?s.state=A.OUTIE:R.push(s),M[t][e]=s,n&&(n.bottom=s),r&&(r.right=s),i&&(i.left=s),o&&(o.top=s)}}}(),Y(),F.isPuzzleSolved()||(console.log("Puzzle not solved, trying hypotheses"),q()),m().then(function(){window.checkIfSolved()?(window.gPuzzleIsComplete=!0,window.DebutSuccessAnimation(),window.SuccessLog(),console.log("Puzzle solved"),l&&(100===window.bookNumber&&window.puzzleNumber===window.getMaxPuzzlesPerBook(window.pkind)?console.log("Reached end of last book!"):(console.log("Going to next puzzle"),setTimeout(window.gotoNextPuzzle,c)))):(console.log("Could not resolve this one..."),window.gPuzzleIsComplete=!1),window.refreshCanvas()});
},{}]},{},["4+sz"], null)