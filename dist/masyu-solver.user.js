// ==UserScript==
// @name        Krazydad Masyu Solver
// @version     1
// @grant       none
// @include     https://krazydad.com/tablet/masyu/*
// @run-at      document-idle
// ==/UserScript==
parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r},p.cache={};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({"k7m8":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(t){this.name=t}return t.register=function(e){for(var n in e)t[n]=new t(n)},t.prototype.isViolated=function(){return this===t.VIOLATED},t.prototype.isResolved=function(){return this===t.RESOLVED},t}();exports.ConstraintResolution=t,t.register({UNCHANGED:0,CHANGED:1,RESOLVED:2,VIOLATED:3});
},{}],"q+8J":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(){}return t.prototype.tryResolve=function(){throw"Not Implemented"},t.prototype.getHypotheses=function(){return[]},t.prototype.backup=function(){},t.prototype.restore=function(){},t}();exports.Constraint=t;
},{}],"eS2z":[function(require,module,exports) {
"use strict";var e=this;exports.__esModule=!0;var r=[];function t(e){r.push(e)}exports.animationSteps=r,exports.recordAnimationStep=t;var n=0;exports.resolvedEdges=n;var o=[];exports.lines=o;var s=0;exports.puzzleSpecialVertices=s;var u={UNKNOWN:{value:0,color:"",inverse:function(){return e}},INNIE:{value:1,color:"#AFF",inverse:function(){return u.OUTIE}},OUTIE:{value:2,color:"#FFA",inverse:function(){return u.INNIE}}};exports.CellState=u;var i={UNKNOWN:{value:0,inverse:function(){return i.UNKNOWN}},EMPTY:{value:1,inverse:function(){return i.FILLED}},FILLED:{value:2,inverse:function(){return i.EMPTY}}};exports.EdgeState=i;
},{}],"kpfx":[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();exports.__esModule=!0;var e=require("./Constraint"),n=require("./ConstraintResolution"),r=require("../globals"),o=function(e){function o(t,n){var r=e.call(this)||this;return r.x=t,r.y=n,r.leftEdge=r.rightEdge=r.topEdge=r.bottomEdge=null,r}return t(o,e),o.prototype.tryResolve=function(){var t=this.unknownEdges;if(0===t.length){var e=this.edges.filter(function(t){return t.isFilled()}).length;return[0,2].includes(e)?n.ConstraintResolution.RESOLVED:n.ConstraintResolution.VIOLATED}if(1===t.length){var o=this.knownEdges.filter(function(t){return t.state===r.EdgeState.FILLED}).length;return 3===o?n.ConstraintResolution.VIOLATED:t[0].setFilled(1===o)}return 2===t.length&&this.knownEdges.every(function(t){return t.state===r.EdgeState.FILLED})?(t.forEach(function(t){t.state=r.EdgeState.EMPTY}),n.ConstraintResolution.RESOLVED):n.ConstraintResolution.UNCHANGED},Object.defineProperty(o.prototype,"edges",{get:function(){return[this.leftEdge,this.rightEdge,this.topEdge,this.bottomEdge]},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"verticalEdges",{get:function(){return[this.topEdge,this.bottomEdge]},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"horizontalEdges",{get:function(){return[this.leftEdge,this.rightEdge]},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"unknownEdges",{get:function(){return this.edges.filter(function(t){return!t.isSolved()})},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"knownEdges",{get:function(){return this.edges.filter(function(t){return t.isSolved()})},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"cells",{get:function(){return this.topEdge.cells.concat(this.bottomEdge.cells)},enumerable:!0,configurable:!0}),o.prototype.hasSameLineAs=function(t){return this.line&&this.line===t.line},o.prototype.getOpposedEdge=function(t){switch(t){case this.leftEdge:return this.rightEdge;case this.rightEdge:return this.leftEdge;case this.topEdge:return this.bottomEdge;case this.bottomEdge:return this.topEdge;default:throw"Not my edge: "+t}},o.prototype.getPerpendicularEdges=function(t){switch(t){case this.leftEdge:case this.rightEdge:return[this.topEdge,this.bottomEdge];case this.topEdge:case this.bottomEdge:return[this.leftEdge,this.rightEdge];default:throw"Not my edge: "+t}},o.prototype.getOpposedCell=function(t){switch(t){case this.leftEdge.top:return this.rightEdge.bottom;case this.rightEdge.top:return this.leftEdge.bottom;case this.leftEdge.bottom:return this.rightEdge.top;case this.rightEdge.bottom:return this.leftEdge.top;default:throw"Not my cell: "+t}},o.prototype.isSpecial=function(){return!1},o.prototype.getHypotheses=function(){if(!this.line)return[];var t=this.unknownEdges;return 2===t.length?t.map(function(t){return[t]}):[]},o.prototype.backup=function(){this._lineBackup=this.line},o.prototype.restore=function(){this.line=this._lineBackup},o.prototype.toString=function(){return this.constructor.name[0]+"("+this.x+","+this.y+")"},o}(e.Constraint);exports.SimpleVertex=o;
},{"./Constraint":"q+8J","./ConstraintResolution":"k7m8","../globals":"eS2z"}],"gCEq":[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();exports.__esModule=!0;var e=require("./SimpleVertex"),n=require("./ConstraintResolution"),r=require("../globals"),i=function(e){function i(t,n){return e.call(this,t,n)||this}return t(i,e),i.prototype.tryResolve=function(){var t=this,r=e.prototype.tryResolve.call(this);if(r===n.ConstraintResolution.VIOLATED)return r;if(r===n.ConstraintResolution.RESOLVED)return 1===this.horizontalEdges.filter(function(t){return t.isFilled()}).length?n.ConstraintResolution.VIOLATED:this.tryEnsureCorner();if(this.unknownEdges.length<4){for(var i=this.knownEdges,o=0,s=i;o<s.length;o++){var u=s[o];if(this.getOpposedEdge(u).setFilled(u.isFilled())===n.ConstraintResolution.VIOLATED)return n.ConstraintResolution.VIOLATED}var l=!i.some(function(t){return t.isFilled()});return this.unknownEdges.map(function(t){return t.setFilled(l)}).some(function(t){return t===n.ConstraintResolution.VIOLATED})?n.ConstraintResolution.VIOLATED:this.tryEnsureCorner()}for(var a=0,p=[this.horizontalEdges,this.verticalEdges];a<p.length;a++){var f=p[a];if(f.every(function(e){return e.getOpposedEdge(t).isFilled()}))return this.markPairEmpty(f);var c=f.map(function(e){return e.getOpposedVertex(t)});if(c[0].hasSameLineAs(c[1])&&!c[0].line.missesOneSpecial())return this.markPairEmpty(f)}return this.cells.filter(function(t){return t.isSolved()}).forEach(function(e){t.getOpposedCell(e).state=e.state.inverse()}),!1},i.prototype.markPairEmpty=function(t){return t.map(function(t){return t.setEmpty()}).some(function(t){return t.isViolated()})||this.getPerpendicularEdges(t[0]).map(function(t){return t.setFilled()}).some(function(t){return t.isViolated()})?n.ConstraintResolution.VIOLATED:this.tryEnsureCorner()},i.prototype.tryEnsureCorner=function(){var t=this,e=this.edges.filter(function(t){return t.state===r.EdgeState.FILLED});if(e.some(function(e){return e.getOpposedVertex(t).getPerpendicularEdges(e).some(function(t){return t.state===r.EdgeState.FILLED})}))return n.ConstraintResolution.RESOLVED;var i=e.find(function(e){return e.getOpposedEdge(t).state===r.EdgeState.FILLED});if(i){var o=this.getOpposedEdge(i).getOpposedEdge(this);return o.isFilled()?n.ConstraintResolution.VIOLATED:(o.state=r.EdgeState.EMPTY,n.ConstraintResolution.RESOLVED)}},i.prototype.getHypotheses=function(){var t=this;if(4===this.knownEdges.length){var e=this.edges.filter(function(t){return t.isFilled()}).map(function(e){return e.getOpposedEdge(t)}).filter(function(t){return!t.isSolved()});return 2===e.length?e.map(function(t){return[function(){return t.setEmpty()}]}):[]}return[this.verticalEdges,this.horizontalEdges]},i.prototype.isSpecial=function(){return!0},i}(e.SimpleVertex);exports.WhiteVertex=i;
},{"./SimpleVertex":"kpfx","./ConstraintResolution":"k7m8","../globals":"eS2z"}],"M8IA":[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();exports.__esModule=!0;var e=require("./SimpleVertex"),n=require("../globals"),o=require("./ConstraintResolution"),r=function(e){function r(t,n){return e.call(this,t,n)||this}return t(r,e),r.prototype.tryResolve=function(){var t=this;this.unknownEdges.forEach(function(e){e.getOpposedEdge(t).state===n.EdgeState.EMPTY&&(e.state=n.EdgeState.EMPTY),e.getOpposedVertex(t).getPerpendicularEdges(e).some(function(t){return t.state===n.EdgeState.FILLED})&&(e.state=n.EdgeState.EMPTY)});for(var e=0,r=this.knownEdges;e<r.length;e++){var i=r[e],s=this.getOpposedEdge(i);if(s.setFilled(!i.isFilled()).isViolated())return o.ConstraintResolution.VIOLATED;if((i.isFilled()?i:s).getOpposedEdge(this).setFilled(!0).isViolated())return o.ConstraintResolution.VIOLATED}return 0===this.unknownEdges.length?o.ConstraintResolution.RESOLVED:o.ConstraintResolution.UNCHANGED},r.prototype.getHypotheses=function(){var t=this;return this.topEdge.isSolved()?this.horizontalEdges.map(function(t){return[t]}):this.leftEdge.isSolved()?this.verticalEdges.map(function(t){return[t]}):this.verticalEdges.reduce(function(e,n){return e.concat(t.horizontalEdges.map(function(t){return[n,t]}))},[])},r.prototype.isSpecial=function(){return!0},r}(e.SimpleVertex);exports.BlackVertex=r;
},{"./SimpleVertex":"kpfx","../globals":"eS2z","./ConstraintResolution":"k7m8"}],"u3hX":[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();exports.__esModule=!0;var e=require("./Constraint"),r=require("./ConstraintResolution"),o=require("../globals"),n=function(e){function n(t){var r=e.call(this)||this;return r.edge=t,r}return t(n,e),n.prototype.tryResolve=function(){var t=this.edge;if(t.isSolved())return r.ConstraintResolution.RESOLVED;if(!this.edgesToWatch){var e=t.vertex1.getOpposedEdge(t),n=t.vertex2.getOpposedEdge(t);this.watchedVertex1=e.getOpposedVertex(t.vertex1),this.watchedVertex2=n.getOpposedVertex(t.vertex2),this.edgesToWatch=[this.watchedVertex1.getOpposedEdge(e),this.watchedVertex2.getOpposedEdge(n)]}return this.watchedVertex1.line&&this.watchedVertex1.line===this.watchedVertex2.line||this.edgesToWatch.some(function(t){return t.state===o.EdgeState.FILLED})?(t.state=o.EdgeState.EMPTY,r.ConstraintResolution.RESOLVED):this.edgesToWatch.every(function(t){return t.state===o.EdgeState.EMPTY})?r.ConstraintResolution.RESOLVED:r.ConstraintResolution.UNCHANGED},n}(e.Constraint);exports.AdjacentWhiteVerticesPair=n;
},{"./Constraint":"q+8J","./ConstraintResolution":"k7m8","../globals":"eS2z"}],"uxLL":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("../globals"),t=function(){function t(e){this.edges=[e],this.setLineOn(e),this.specialVertices=e.vertices.filter(function(e){return e.isSpecial()}).length,this.start=e.vertex1,this.end=e.vertex2}return t.prototype.addEdge=function(e){var t;this.edges.push(e),this.setLineOn(e),t=e.contains(this.start)?this.start=e.getOpposedVertex(this.start):this.end=e.getOpposedVertex(this.end),console.assert(this.start!==this.end||this.isSolution(),"Cannot close incomplete loop"),t.isSpecial()&&this.start!==this.end&&(this.specialVertices++,this.checkSpecialVertices())},t.prototype.setLineOn=function(e){var t=this;e.line=this,e.vertices.forEach(function(e){e.line=t})},t.prototype.mergeWith=function(e,t){var i,s=this;this.edges.push(t),this.setLineOn(t),(i=this.edges).push.apply(i,e.edges),this.specialVertices+=e.specialVertices,this.checkSpecialVertices(),e.edges.forEach(function(e){return s.setLineOn(e)});var n=t.contains(e.start)?e.end:e.start;t.contains(this.start)?this.start=n:this.end=n},t.prototype.containsAllSpecials=function(){return this.specialVertices===e.puzzleSpecialVertices},t.prototype.checkSpecialVertices=function(){if(this.specialVertices>e.puzzleSpecialVertices)throw"IllegalState, too many specials: "+this.specialVertices},t.prototype.isAlmostSolution=function(){return this.specialVertices===e.puzzleSpecialVertices},t.prototype.missesOneSpecial=function(){return this.specialVertices===e.puzzleSpecialVertices-1},t.prototype.isSolution=function(){return this.specialVertices===e.puzzleSpecialVertices&&this.start===this.end},t.prototype.backup=function(){this._edgesBackup=this.edges.slice(0),this._specialVerticesBackup=this.specialVertices,this._startBackup=this.start,this._endBackup=this.end},t.prototype.restore=function(){this.edges=this._edgesBackup,this.specialVertices=this._specialVerticesBackup,this.start=this._startBackup,this.end=this._endBackup},t.prototype.toString=function(){return"L["+this.start+"->"+this.end+"]"},t.recordFilledEdge=function(i){var s=i.vertices.map(function(e){return e.line}).filter(function(e){return e}),n=null;switch(s.length){case 0:n=new t(i),e.lines.push(n);break;case 1:(n=s[0]).addEdge(i);break;case 2:n=s[0];var r=s[1];n===r?n.addEdge(i):(n.mergeWith(r,i),e.lines=e.lines.filter(function(e){return e!==r}))}},t.isPuzzleSolved=function(){return 1===e.lines.length&&e.lines[0].isSolution()},t.backup=function(){t._linesBackup=e.lines.slice(0),e.lines.forEach(function(e){return e.backup()})},t.restore=function(){e.lines=t._linesBackup,e.lines.forEach(function(e){return e.restore()})},t}();exports.Line=t;
},{"../globals":"eS2z"}],"b6ZM":[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();exports.__esModule=!0;var e=require("./Constraint"),i=require("./ConstraintResolution"),s=require("../globals"),n=require("./Line"),o=function(e){function o(t){var i=e.call(this)||this;return i._state=s.EdgeState.UNKNOWN,i.puzzEdge=t,i}return t(o,e),o.prototype.isSolved=function(){return this.state!==s.EdgeState.UNKNOWN},o.prototype.isFilled=function(){return this.state===s.EdgeState.FILLED},o.prototype.setFilled=function(t){return"boolean"!=typeof t&&(t=!0),this.isSolved()?this.isFilled()!==t?i.ConstraintResolution.VIOLATED:i.ConstraintResolution.RESOLVED:this.cell1.isSolved()&&this.cell2.isSolved()&&this.cell1.state===this.cell2.state===t?i.ConstraintResolution.VIOLATED:t&&this.vertex1.hasSameLineAs(this.vertex2)&&!this.vertex1.line.isAlmostSolution()?i.ConstraintResolution.VIOLATED:(this.state=t?s.EdgeState.FILLED:s.EdgeState.EMPTY,i.ConstraintResolution.RESOLVED)},o.prototype.isEmpty=function(){return this.state===s.EdgeState.EMPTY},o.prototype.setEmpty=function(){return this.setFilled(!1)},o.prototype.tryResolve=function(){return this.isSolved()?i.ConstraintResolution.RESOLVED:this.cell1.isSolved()&&this.cell2.isSolved()?this.setFilled(this.cell1.state!==this.cell2.state):this.vertex1.line&&this.vertex1.line===this.vertex2.line&&!this.vertex1.line.containsAllSpecials()?(this.state=s.EdgeState.EMPTY,i.ConstraintResolution.RESOLVED):i.ConstraintResolution.UNCHANGED},Object.defineProperty(o.prototype,"state",{get:function(){return this._state},set:function(t){if(this.isSolved()&&t!==this._state)throw"IllegalState: "+this+" is already solved";switch(t){case s.EdgeState.EMPTY:case s.EdgeState.FILLED:break;default:throw"IllegalArgument: "+t}this._state!==t&&(s.resolvedEdges++,this._state=t,this.syncWithCanvas(),t===s.EdgeState.FILLED&&n.Line.recordFilledEdge(this))},enumerable:!0,configurable:!0}),o.prototype.syncWithCanvas=function(){var t=this;if(this.puzzEdge){var e=this.state.value;s.recordAnimationStep(function(){t.puzzEdge.s=e})}},Object.defineProperty(o.prototype,"vertices",{get:function(){return[this.vertex1,this.vertex2]},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"cells",{get:function(){return[this.cell1,this.cell2]},enumerable:!0,configurable:!0}),o.prototype.contains=function(t){return this.vertices.some(function(e){return e===t})},o.prototype.getOpposedVertex=function(t){return t===this.vertex1?this.vertex2:this.vertex1},o.prototype.getOpposedEdge=function(t){return this.getOpposedVertex(t).getOpposedEdge(this)},o.prototype.getOpposedCell=function(t){return t===this.cell1?this.cell2:this.cell1},o.prototype.backup=function(){this._stateBackup=this._state,this._lineBackup=this.line},o.prototype.restore=function(){this.line=this._lineBackup,this._state!==this._stateBackup&&(this._state=this._stateBackup,this.syncWithCanvas())},o.prototype.toString=function(){return"E["+this.vertex1+"->"+this.vertex2+"]"},o}(e.Constraint);exports.SolverEdge=o;
},{"./Constraint":"q+8J","./ConstraintResolution":"k7m8","../globals":"eS2z","./Line":"uxLL"}],"9CC4":[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();exports.__esModule=!0;var e=require("./SolverEdge"),r=function(e){function r(t,r,o){var n=e.call(this,o)||this;return n.top=t,n.bottom=r,n.left=null,n.right=null,n}return t(r,e),Object.defineProperty(r.prototype,"cell1",{get:function(){return this.left},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cell2",{get:function(){return this.right},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"vertex1",{get:function(){return this.top},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"vertex2",{get:function(){return this.bottom},enumerable:!0,configurable:!0}),r}(e.SolverEdge);exports.VerticalSolverEdge=r;
},{"./SolverEdge":"b6ZM"}],"9znY":[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();exports.__esModule=!0;var e=require("./SolverEdge"),r=function(e){function r(t,r,o){var n=e.call(this,o)||this;return n.left=t,n.right=r,n.top=null,n.bottom=null,n}return t(r,e),Object.defineProperty(r.prototype,"cell1",{get:function(){return this.top},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cell2",{get:function(){return this.bottom},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"vertex1",{get:function(){return this.left},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"vertex2",{get:function(){return this.right},enumerable:!0,configurable:!0}),r}(e.SolverEdge);exports.HorizontalSolverEdge=r;
},{"./SolverEdge":"b6ZM"}],"Nf6H":[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();exports.__esModule=!0;var e=require("./Constraint"),r=require("./ConstraintResolution"),o=require("../globals"),n=function(e){function n(t,r,n,i,s){var u=e.call(this)||this;return u.top=t,u.left=r,u.right=n,u.bottom=i,u._state=o.CellState.UNKNOWN,u.puzzCell=s,u}return t(n,e),n.prototype.isSolved=function(){return this.solved},Object.defineProperty(n.prototype,"solved",{get:function(){return this._state!==o.CellState.UNKNOWN},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"innie",{get:function(){return this._state===o.CellState.INNIE},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"outie",{get:function(){return this._state===o.CellState.OUTIE},enumerable:!0,configurable:!0}),n.prototype.tryResolve=function(){var t=this;if(this.isSolved())return r.ConstraintResolution.RESOLVED;var e=this.edges.find(function(e){return e.isSolved()&&e.getOpposedCell(t).isSolved()});if(e){var o=e.getOpposedCell(this);return this.state=e.isFilled()?o.state.inverse():o.state,r.ConstraintResolution.RESOLVED}return r.ConstraintResolution.UNCHANGED},Object.defineProperty(n.prototype,"edges",{get:function(){return[this.top,this.left,this.right,this.bottom]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"state",{get:function(){return this._state},set:function(t){var e=this;if(this._state!==t&&(this._state=t,this.puzzCell)){var r=t.color;o.recordAnimationStep(function(){e.puzzCell.fill=r})}},enumerable:!0,configurable:!0}),n.prototype.backup=function(){this._stateBackup=this._state},n.prototype.restore=function(){this.state=this._stateBackup},n}(e.Constraint);exports.SolverCell=n;
},{"./Constraint":"q+8J","./ConstraintResolution":"k7m8","../globals":"eS2z"}],"ZCfc":[function(require,module,exports) {
"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}var t=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function s(e){try{a(o.next(e))}catch(e){i(e)}}function l(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,l)}a((o=o.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}};exports.__esModule=!0;var o=require("./classes/ConstraintResolution"),r=require("./classes/SimpleVertex"),i=require("./classes/WhiteVertex"),s=require("./classes/BlackVertex"),l=require("./classes/AdjacentWhiteVerticesPair"),a=require("./classes/VerticalSolverEdge"),u=require("./classes/HorizontalSolverEdge"),c=require("./classes/SolverCell"),f=require("./classes/Line"),d=require("./globals"),h="OMG, it's Typescript!";console.log(h);var v=!0,p=50,g=!1,w=2e3;if(!v)throw new Error("stop execution");var y=window.puzzWidth,b=window.puzzHeight,E=window.myVerts,S=window.myEdges,C=window.myCells;if(!(y&&b&&E&&S&&C))throw new Error("Solver: missing key variable ("+y+", "+b+", "+E+", "+S+", "+C+")");function z(e,t){return e<0||e>y||t<0||t>b?null:E[e+(y+1)*t]}function m(e,t,n,o){return S.find(function(r){return r.x1===e&&r.x2===n&&r.y1===t&&r.y2===o||r.x1===n&&r.x2===e&&r.y1===o&&r.y2===t})}function x(e,t){return e<0||e>=y||t<0||t>=b?null:C[e+y*t]}function V(e,t){return new Promise(function(n){return setTimeout(n,e,t)})}function k(){return t(this,void 0,void 0,function(){var e,t;return n(this,function(n){switch(n.label){case 0:console.log("Playing animation"),e=0,t=d.animationSteps,n.label=1;case 1:return e<t.length?((0,t[e])(),p?(window.refreshCanvas(),[4,V(p)]):[3,3]):[3,4];case 2:n.sent(),n.label=3;case 3:return e++,[3,1];case 4:return window.refreshCanvas(),[2]}})})}console.log("Initializing solver for "+y+"×"+b);var A=[],R=[];function P(e){e.vertex1 instanceof i.WhiteVertex&&e.vertex2 instanceof i.WhiteVertex&&(e.vertex1.getOpposedEdge(e).getOpposedVertex(e.vertex1)instanceof i.WhiteVertex?e.state=d.EdgeState.EMPTY:A.push(new l.AdjacentWhiteVerticesPair(e))),e.vertex1 instanceof s.BlackVertex&&e.vertex2 instanceof s.BlackVertex&&(e.state=d.EdgeState.EMPTY)}!function(){for(var e=-1;e<=y+1;e++){R[e]=[];for(var t=-1;t<=b+1;t++){var n=z(e,t),o=void 0;if(n&&"_"!==n.clue)switch(n.clue){case"O":o=new i.WhiteVertex(e,t),d.puzzleSpecialVertices++;break;case"@":o=new s.BlackVertex(e,t),d.puzzleSpecialVertices++;break;default:throw"Unknown clue: "+e+","+t+": "+n.clue}else o=new r.SimpleVertex(e,t);R[e][t]=o,e>=0&&e<=y&&t>=0&&t<=b&&A.push(o)}}}();var D=[];!function(){for(var e=-1;e<=y;e++){D[e]=[];for(var t=0;t<=b;t++){var n=R[e][t],o=R[e+1][t],r=new u.HorizontalSolverEdge(n,o,m(e,t,e+1,t));D[e][t]=r,e<0||e===y?r.state=d.EdgeState.EMPTY:A.push(r),n.rightEdge=r,o.leftEdge=r,e>0&&e<y-1&&P(r)}}}();var T=[];!function(){for(var e=0;e<=y;e++){T[e]=[];for(var t=-1;t<=b;t++){var n=R[e][t],o=R[e][t+1],r=new a.VerticalSolverEdge(n,o,m(e,t,e,t+1));T[e][t]=r,t<0||t===b?r.state=d.EdgeState.EMPTY:A.push(r),n.bottomEdge=r,o.topEdge=r,t>0&&t<b-1&&P(r)}}}();var H=[];function N(){for(var e=A.length,t=[],n=0,r=A;n<r.length;n++){var i=r[n];switch(i.tryResolve()){case o.ConstraintResolution.VIOLATED:return o.ConstraintResolution.VIOLATED;case o.ConstraintResolution.RESOLVED:break;default:t.push(i)}}return e!==(A=t).length?o.ConstraintResolution.CHANGED:o.ConstraintResolution.UNCHANGED}function L(){var e=d.resolvedEdges,t=N();return t===o.ConstraintResolution.VIOLATED?t:t===o.ConstraintResolution.CHANGED||e!==d.resolvedEdges?o.ConstraintResolution.CHANGED:o.ConstraintResolution.UNCHANGED}function G(){var e,t=0;do{if(t++,(e=L())===o.ConstraintResolution.VIOLATED)return e}while(e===o.ConstraintResolution.CHANGED);return t>1?o.ConstraintResolution.CHANGED:o.ConstraintResolution.UNCHANGED}function O(e){return e.forEach(function(e){return"function"==typeof e?e():e.setFilled()}),G()}function q(){var t;do{window.refreshCanvas(),t=!1;for(var n=function(n){for(var r=n.getHypotheses(),i=[],s=function(e){console.log("Trying hypothesis "+e),d.recordAnimationStep(function(){return console.log("Showing hypothesis "+e)});var t=d.resolvedEdges,n=A.slice(0);if(f.Line.backup(),A.forEach(function(e){return e.backup()}),O(e)!==o.ConstraintResolution.VIOLATED){if(f.Line.isPuzzleSolved())return console.log("Puzzle appears to be solved"),{value:void 0};i.push(e),d.recordAnimationStep(function(){return console.log("Reverting hypothesis "+e)})}else console.log("Hypothesis rejected"),d.recordAnimationStep(function(){return console.log("Hypothesis "+e+" rejected")});n.forEach(function(e){return e.restore()}),f.Line.restore(),A=n,d.resolvedEdges=t},l=0,a=r;l<a.length;l++){var u=s(a[l]);if("object"===e(u))return u}if(console.assert(0===r.length||i.length>0,"At least one hypothesis should be valid"),1===i.length){var c=i[0];return console.log("Keeping single valid hypothesis "+c),d.recordAnimationStep(function(){return console.log("Restoring single valid hypothesis "+c)}),O(c),t=!0,"break"}},r=0,i=A;r<i.length;r++){var s=n(i[r]);if("object"===e(s))return s.value;if("break"===s)break}}while(t)}!function(){for(var e=-1;e<=y;e++){H[e]=[];for(var t=-1;t<=b;t++){var n=void 0,o=void 0,r=void 0,i=void 0;n=t>=0?n=D[e][t]:null,o=e>=0?T[e][t]:null,r=e<y?T[e+1][t]:null,i=t<b?D[e][t+1]:null;var s=new c.SolverCell(n,o,r,i,x(e,t));-1===e||e===y||-1===t||t===b?s.state=d.CellState.OUTIE:A.push(s),H[e][t]=s,n&&(n.bottom=s),o&&(o.right=s),r&&(r.left=s),i&&(i.top=s)}}}(),G(),f.Line.isPuzzleSolved()||(console.log("Puzzle not solved, trying hypotheses"),q()),k().then(function(){window.checkIfSolved()?(window.gPuzzleIsComplete=!0,window.DebutSuccessAnimation(),window.SuccessLog(),console.log("Puzzle solved"),g&&(100===window.bookNumber&&window.puzzleNumber===window.getMaxPuzzlesPerBook(window.pkind)?console.log("Reached end of last book!"):(console.log("Going to next puzzle"),setTimeout(window.gotoNextPuzzle,w)))):(console.log("Could not resolve this one..."),window.gPuzzleIsComplete=!1),window.refreshCanvas()});
},{"./classes/ConstraintResolution":"k7m8","./classes/SimpleVertex":"kpfx","./classes/WhiteVertex":"gCEq","./classes/BlackVertex":"M8IA","./classes/AdjacentWhiteVerticesPair":"u3hX","./classes/VerticalSolverEdge":"9CC4","./classes/HorizontalSolverEdge":"9znY","./classes/SolverCell":"Nf6H","./classes/Line":"uxLL","./globals":"eS2z"}]},{},["ZCfc"], null)